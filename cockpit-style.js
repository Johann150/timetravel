function frame(e){"answero"==e?(document.getElementById("answer").setAttribute("data-frame","true"),document.getElementById("help").setAttribute("data-frame","false"),rightEmpty("Antworten")):"true"==e.getAttribute("data-frame")?e.setAttribute("data-frame","false"):(e.setAttribute("data-frame","true"),"done"==e.id?(document.getElementById("answer").setAttribute("data-frame","true"),document.getElementById("help").setAttribute("data-frame","false"),document.getElementById("inbox").setAttribute("data-frame","false"),document.getElementById("user").setAttribute("data-frame","false"),leftEmpty("gel&ouml;st"),rightEmpty("Antworten"),displayClass("done"),hideClass("answer")):"user"==e.id?(document.getElementById("inbox").setAttribute("data-frame","false"),document.getElementById("done").setAttribute("data-frame","false"),leftEmpty("Info"),displayClass("user")):"answer"==e.id||"inbox"==e.id?(document.getElementById("answer").setAttribute("data-frame","true"),document.getElementById("inbox").setAttribute("data-frame","true"),document.getElementById("inbox").removeAttribute("data-notf"),document.getElementById("done").setAttribute("data-frame","false"),document.getElementById("user").setAttribute("data-frame","false"),document.getElementById("help").setAttribute("data-frame","false"),hideClass("answer"),displayClass("inbox"),leftEmpty("Nachrichten"),rightEmpty("Antworten")):"help"==e.id?(document.getElementById("answer").setAttribute("data-frame","false"),rightEmpty("Hilfe"),displayClass("help")):"logout"==e.id&&(document.getElementById("inbox").setAttribute("data-frame","false"),document.getElementById("done").setAttribute("data-frame","false"),document.getElementById("user").setAttribute("data-frame","false"),document.getElementById("answer").setAttribute("data-frame","false"),document.getElementById("help").setAttribute("data-frame","false"),balert("<p>Du bist schon fertig. Wenn du dein Support-Terminal verlässt, werden dein Quality-Score und alle deine vorgenommenen Einstellungen gelöscht. Bist du sicher, dass du den Support beenden möchtest?</p>Wenn nein: Danke für deine freiwillige Teilnahme am TimeTravel™ Dispatcher Project.<br>Wenn ja: Schade, aber danke für deine kurzweilige Unterstützung.<br>Wirklich beenden?<br><button onclick=\"logout();\">ja</button>&nbsp;<button onclick=\"deBalert();document.getElementById('logout').setAttribute('data-frame','false');\">nein</button>"))),"false"==document.getElementById("inbox").getAttribute("data-frame")&&(hideClass("inbox"),"false"==document.getElementById("done").getAttribute("data-frame")&&"false"==document.getElementById("user").getAttribute("data-frame")&&leftEmpty("(leer)")),"false"==document.getElementById("done").getAttribute("data-frame")&&hideClass("done"),"false"==document.getElementById("answer").getAttribute("data-frame")&&(hideClass("answer"),"false"==document.getElementById("help").getAttribute("data-frame")&&rightEmpty("(leer)")),"false"==document.getElementById("help").getAttribute("data-frame")&&hideClass("help"),"false"==document.getElementById("user").getAttribute("data-frame")&&hideClass("user")}function balert(e){document.getElementById("msg").style.opacity=1,document.getElementById("msg").style.display="block",document.getElementById("msg").innerHTML=e}function deBalert(){document.getElementById("msg").style.opacity=0,document.getElementById("msg").style.display="none"}function getScore(e){return score=document.getElementById("score").style.width.replace("%",""),""==score?score=0:score=parseInt(score),score}function scoreAdd(e){score=getScore()+e,score>=100&&(score=100,balert("<strong>Danke f&uuml;r deine freiwillige Teilnahme am TimeTravel Dispatcher Project.</strong><br><img src='icons/world.svg' id='endlogo'><p>Dein Quality-Score hat das Ende des Free-Plans erreicht. Du hast das echte Zeug zu einem offiziellen Latein-Supporter in der TimeTravel™ Community.</p><p>Bewirb dich dazu auf unsere Career-Seite, mit deiner Teilnahme-ID.  Achtung: Diese Möglichkeit wird voraussichtlich erst ab Mitte August 2190 zur Verfügung stehen. Wir benachrichtigen dich sobald es die Bewerbungsmöglichkeit in einer Beta-Version gibt.</p><button onclick='logout()'>Speichern und Beenden</button>")),document.getElementById("score").style.width=score+"%",document.getElementById("scorecnt").innerHTML=score+"%"}function logout(){document.body.style.opacity="0",setTimeout(function(){window.location.href="index.html"},1e3)}function item(e,t){if("true"==t.getAttribute("data-frame"))t.setAttribute("data-frame","false");else{elems=document.getElementsByClassName(e);for(var s=0;s<elems.length;s++){var n=elems[s];n.setAttribute("data-frame","false"),"answer"==e&&(n.style.visibility="hidden",n.style.opacity=0)}t.setAttribute("data-frame","true"),"answer"==e&&(t.style.visibility="visible",t.style.opacity=1)}}function selected(e,t){"true"==t.getAttribute("data-frame")?hideClass("answer"):(document.getElementById("answer").setAttribute("data-frame","true"),document.getElementById("help").setAttribute("data-frame","false"),hideClass("help")),message=t.getAttribute("data-message"),msgs=document.querySelectorAll('[data-message="'+message+'"]');for(var s=0;s<msgs.length;s++)msgs[s].classList.contains("inbox")?item("inbox",msgs[s]):msgs[s].classList.contains("done")?item("done",msgs[s]):msgs[s].classList.contains("answer")&&item("answer",msgs[s])}function leftEmpty(e){var t=document.getElementById("left");nodes=t.childNodes;for(var s=0;s<nodes.length;s++)if(c=nodes[s],"empty"==c.className){c.innerHTML=e;break}}function rightEmpty(e){var t=document.getElementById("right");nodes=t.childNodes;for(var s=0;s<nodes.length;s++)if(c=nodes[s],"empty"==c.className){c.innerHTML=e;break}}function hideClass(t){for(var s=document.getElementsByClassName(t),n=0;n<s.length;n++)e=s[n],e.style.opacity=0,e.style.visibility="hidden";"inbox"==t?setTimeout(function(){document.getElementById("containermessage").style.display="none"},500):"done"==t&&setTimeout(function(){document.getElementById("containerdone").style.display="none"},500)}function displayClass(t){"inbox"==t?document.getElementById("containermessage").style.display="block":"done"==t&&(document.getElementById("containerdone").style.display="block");for(var s=document.getElementsByClassName(t),n=0;n<s.length;n++)e=s[n],e.style.opacity=1,e.style.visibility="visible"}function newMessage(t){"undefined"==typeof t&&(t="q");var s;s=new XMLHttpRequest,s.onreadystatechange=function(){if(4==this.readyState&&200==this.status){console.info(s.responseText);var t=JSON.parse(s.responseText);elem=document.createElement("div"),elem.classList.add("msg"),elem.classList.add("inbox"),elem.innerHTML="<h3>"+t.subject+"</h3>"+t.message,elem.setAttribute("data-message",msgID),elem.setAttribute("onclick","selected('inbox',this);"),document.getElementById("containermessage").appendChild(elem),elem=document.createElement("div"),elem.classList.add("ritem"),elem.classList.add("answer"),elem.setAttribute("data-message",msgID),sub=document.createElement("div"),sub.classList.add("keys"),sub.innerHTML=t.keys,elem.appendChild(sub),sub=document.createElement("div"),sub.classList.add("widget"),sub.innerHTML=t.widget.html,elem.appendChild(sub),sub=document.createElement("div"),sub.classList.add("message"),sub.innerHTML="<h3>"+t.subject+"</h3>"+t.message,elem.appendChild(sub),document.getElementById("right").appendChild(elem),ans[msgID]={answer:t.answer,reply:t.reply},msgID++,"true"==document.getElementById("inbox").getAttribute("data-frame")?displayClass("inbox"):document.getElementById("inbox").setAttribute("data-notf",""),e=new Notification("neue Supportnachricht",{body:"Betreff: "+escapeHtml(t.subject),icon:window.location.toString().replace(/[\\\/][^\\\/]*$/,"")+"/icons/time-passing.png",tag:"newmessage"})}},s.open("GET",window.location.pathname.replace(/[\\\/][^\\\/]*$/,"")+"/data.php?r="+t,!0),s.send()}function check(e){if(widget=e.getAttribute("data-widget"),"eingabe"==widget||"yesno"==widget)if(msg=e.parentNode.parentNode.getAttribute("data-message"),""==e.answer.value)console.warn("empty");else{if(null==msg)return!1;ans[msg].answer==e.answer.value?(deleteMessage(msg),setTimeout(function(){scoreAdd(Math.floor((10*Math.random()+1)*t)),insertAnswer(ans[msg].reply.right)},1e3+Math.floor(100*Math.random()-50))):(deleteMessage(msg),setTimeout(function(){scoreAdd(Math.floor((-10*Math.random()-1)*t)),insertAnswer(ans[msg].reply.wrong,msg)},1e3+Math.floor(100*Math.random()-50)))}else"leer"==widget&&deleteMessage(e.parentNode.parentNode.getAttribute("data-message"));return!1}function insertAnswer(e,t){elem=document.createElement("div"),elem.classList.add("msg"),elem.classList.add("inbox"),elem.classList.add("ans"),elem.innerHTML="<h3>"+e.subject+"</h3>"+e.message,elem.setAttribute("data-message",t+"r"),elem.setAttribute("onclick","selected('inbox',this);"),document.getElementById("containermessage").appendChild(elem),elem=document.createElement("div"),elem.classList.add("ritem"),elem.classList.add("answer"),elem.setAttribute("data-message",t+"r"),sub=document.createElement("div"),sub.classList.add("keys"),sub.innerHTML=e.keys,elem.appendChild(sub),sub=document.createElement("div"),sub.classList.add("widget"),sub.innerHTML='<form onsubmit="return check(this);" data-widget="leer"><input type="submit" name="submit" value="entfernen"/></form>',elem.appendChild(sub),sub=document.createElement("div"),sub.classList.add("message"),sub.innerHTML="<h3>"+e.subject+"</h3>"+e.message,elem.appendChild(sub),document.getElementById("right").appendChild(elem),"true"==document.getElementById("inbox").getAttribute("data-frame")?displayClass("inbox"):document.getElementById("inbox").setAttribute("data-notf","")}function deleteMessage(e){del=document.querySelectorAll('[data-message="'+e+'"]');for(var t=0;t<del.length;t++)if(del[t].style.opacity=0,del[t].style.visibility="hidden",del[t].setAttribute("data-frame","false"),del[t].classList.contains("inbox"))document.getElementById("containerdone").appendChild(del[t]),del[t].classList.remove("inbox"),del[t].classList.add("done"),del[t].setAttribute("onclick","selected('done',this);");else if(del[t].classList.contains("answer")){f=del[t].getElementsByTagName("form")[0],f.removeAttribute("data-message");try{f.submit.remove()}catch(s){}elem=f.getElementsByTagName("input");for(var n=0;n<elem.length;n++)elem[n].setAttribute("disabled","off")}}function escapeHtml(e){var t=document.createElement("div");return t.innerHTML=e,0===t.childNodes.length?"":t.childNodes[0].nodeValue}Notification.requestPermission(),document.addEventListener("load",function(){hideClass("inbox"),hideClass("answer"),hideClass("help"),hideClass("done"),frame(document.getElementById("help"))});var msgID=0,ans=[];!function s(){setTimeout(function(){newMessage(),getScore()<100&&s()},Math.round(4e4*Math.random())+1e3)}();
